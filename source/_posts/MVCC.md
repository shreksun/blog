---
title: MVCC
date: 2019-03-08 15:17:54
categories:
- DB
tags:
- mvcc
---

#### 定义

多版本并发控制，读不加锁，每次读最新的快照。一条数据记录的时候，它不会直接用新数据覆盖旧数据，而是将旧数据标记为过时（obsolete）并在别处增加新版本的数据。这样就会有存储多个版本的数据，但是只有一个是最新的。

<!--more-->

#### 实现

innoDB的MVCC,是通过在每行记录后面保存两个隐藏的列来实现的,这两个列，分别保存了这个行的**创建时间（创建时版本号）**，一个保存的是行的**删除时间（删除时版本号）**。

* **INSERT** InnoDB为新插入的每一行保存当前系统版本号作为版本号. 

* **SELECT** a. 只会查找版本早于或等于当前事务版本的

  ​	       b. 删除版本要么未定义，要么大于当前版本

  ​	       同时满足a. b.才会作为返回结果

* **DELETE** InnoDB会为删除的每一行保存当前系统的版本号(事务的ID)作为删除标识. 

* **UPDATE** InnoDB执行UPDATE，**实际上是新插入了一行记录，并保存其创建时间为当前事务的ID，同时保存当前事务ID到要UPDATE的行的删除时间**.



参考：

[什么是MVCC ](https://blog.csdn.net/yajie_12/article/details/80453863)